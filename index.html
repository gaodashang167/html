<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>实时新闻聚合平台（调试版）</title>
    <style>
        /* 调试样式 */
        .debug-console {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            color: #00ff88;
            padding: 1rem;
            font-family: monospace;
            z-index: 9999;
            max-height: 200px;
            overflow-y: auto;
        }
        
        /* 原有样式保持不变... */
    </style>
</head>
<body>
    <!-- 调试控制台 -->
    <div class="debug-console" id="debugConsole"></div>

    <script>
        // 调试日志系统
        const debug = {
            log: (message) => {
                const console = document.getElementById('debugConsole');
                const entry = document.createElement('div');
                entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                console.appendChild(entry);
                console.scrollTop = console.scrollHeight;
            },
            clear: () => {
                document.getElementById('debugConsole').innerHTML = '';
            }
        };

        // 启动调试
        debug.log('开始初始化...');

        // 增强版新闻生成器（带错误处理）
        class NewsGenerator {
            constructor() {
                debug.log('新闻生成器实例创建');
                try {
                    this.newsPool = this.initializeNewsPool();
                    this.initContainer();
                    this.startUpdate();
                } catch (error) {
                    debug.log(`初始化失败: ${error}`);
                    this.showErrorMessage();
                }
            }

            initializeNewsPool() {
                debug.log('正在初始化新闻数据池...');
                return {
                    zhihu: this.generateInitialData('zhihu', 3),
                    weibo: this.generateInitialData('weibo', 3),
                    douyin: this.generateInitialData('douyin', 2)
                };
            }

            generateInitialData(platform, count) {
                debug.log(`生成初始数据: ${platform}`);
                return Array.from({length: count}, (_, i) => ({
                    id: Date.now() + i,
                    title: this.generateTitle(platform),
                    ...this.generateInteractionData(platform),
                    timestamp: Date.now()
                }));
            }

            initContainer() {
                debug.log('正在初始化DOM容器...');
                try {
                    const container = document.createElement('div');
                    container.className = 'news-container';
                    container.innerHTML = `
                        <nav class="news-nav">
                            <div class="news-tab active">热门</div>
                            <div class="news-tab">最新</div>
                            <div class="news-tab">关注</div>
                        </nav>
                        <div id="newsContent"></div>
                    `;
                    document.body.insertBefore(container, document.querySelector('.debug-console'));
                    debug.log('DOM容器初始化成功');
                } catch (error) {
                    debug.log(`DOM初始化错误: ${error}`);
                    throw new Error('DOM操作失败');
                }
            }

            // 其他方法保持不变，添加错误处理...

            showErrorMessage() {
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    padding: 2rem;
                    background: #ff4757;
                    color: white;
                    border-radius: 8px;
                    text-align: center;
                `;
                errorDiv.innerHTML = `
                    <h2>内容加载失败</h2>
                    <p>请检查以下可能原因：</p>
                    <ul>
                        <li>浏览器不支持JavaScript</li>
                        <li>网络连接异常</li>
                        <li>系统资源不足</li>
                    </ul>
                    <button onclick="location.reload()">重新加载</button>
                `;
                document.body.appendChild(errorDiv);
            }
        }

        // 启动应用
        debug.log('准备启动新闻生成器...');
        document.addEventListener('DOMContentLoaded', () => {
            debug.log('DOM加载完成');
            try {
                window.newsGen = new NewsGenerator();
                debug.log('应用启动成功');
            } catch (error) {
                debug.log(`启动失败: ${error}`);
            }
        });

        // 容错处理
        window.onerror = function(message, source, lineno, colno, error) {
            debug.log(`全局错误: ${message} (${source}:${lineno})`);
            return true;
        };
    </script>
</body>
</html>
